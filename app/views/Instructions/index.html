#{extends 'main.html'/}
#{set title:'Logpal Admin Console' /}
<style>
	.page-header {	    
	    margin: 15px 0 12px!important;
	}
	.map {
	width: 350px;
	height: 250px;
	}
	.ui-tooltip {
		max-width: 550px;
	}
	.borderTr{
	 	border-bottom: 1px solid #EEEEEE;	    
    }	
</style>
<script>
//function to show tool-tip.
$(function() {
	$( document ).tooltip({
		items: "[data-geo]",
		content: function() {
			var element = $( this );
			if ( element.is( "[data-geo]" ) ) {
				var text = element.text();
				return getQueueHelp(); 
			}
			if ( element.is( "[title]" ) ) {
				return element.attr( "title" );
			}
			if ( element.is( "img" ) ) {
				return element.attr( "alt" );
			}
		}
	});
});
//Function for datepicker for Start.
$(function() {
	$("#startTimeDt").datepicker({
		changeMonth: true,
        changeYear: true,
		onSelect: function(){
		    $(this).change();
		    setUtcTime("startTimeDt", "startTime", false);
		}
	})
});
//Function for datepicker for End.
$(function() {
	$("#endTimeDt").datepicker({
		changeMonth: true,
        changeYear: true,
		onSelect: function(){
		    $(this).change();
		    setUtcTime("endTimeDt", "endTime", true);
		}
	})
});

function setUtcTime(src, dst, endDay){
	var stDt = $("#"+src).datepicker( "getDate" );
	if(stDt!=null){
		if(endDay==true){
			stDt.setHours(23, 59, 59, 999);
		}
		$("#"+dst).val(stDt.toISOString());
	}else{
		$("#"+dst).text("");
	}	
}
//Start  - Activity report handling functions
$(function() {	
	$( "#ActivityReportType" ).bind('click change', function() {
		if($(this).val()!="admin"){			
			$("#lblEventType").html('Filter By Event Name:');
			$("#divActivityEventAdmin").hide();
			$("#divActivityEventDoc").show();
			$("#trActivityEventAdminProp").hide();
			
		}else{			
			$("#lblEventType").html('Filter By Activity Type:');
			$("#divActivityEventDoc").hide();
			$("#divActivityEventAdmin").show();
			$("#trActivityEventAdminProp").show();
		}
	});
	
	$("#ActivityEventAdmin").bind('change', function() {		
		var options = $("#ActivityEventAdminProp");
		//Clear old options
		options.empty().append('<option selected="selected" value="">-- None --</option>');
		//Update new Options.
		$.each(activityType[$(this).val()], function() {
		    options.append(new Option(this, this));
		});
	});
});

//Mapping for  Admin-Activity event names.
var activityType = {
	'APPLICATION_SETTINGS' : ['CHANGE_APPLICATION_SETTING', 'CREATE_APPLICATION_SETTING', 'DELETE_APPLICATION_SETTING'],
	'CALENDAR_SETTINGS' : ['CHANGE_CALENDAR_SETTING', 'CREATE_CALENDAR_RESOURCE', 'DELETE_CALENDAR_RESOURCE', 'RENAME_CALENDAR_RESOURCE'],
	'CHAT_SETTINGS': ['CREATE_ORG_UNIT', 'EDIT_ORG_UNIT_DESCRIPTION', 'EDIT_ORG_UNIT_NAME', 'MOVE_ORG_UNIT', 'REMOVE_ORG_UNIT', 'TOGGLE_SERVICE_ENABLED'],
	'CHROME OS_SETTINGS' : ['CHANGE_CHROME_OS_SETTING'],
	'CONTACTS_SETTINGS' : ['CHANGE_CHAT_SETTING'],
	'DELEGATED_ADMIN' : ['ADD_PRIVILEGE', 'ASSIGN_ROLE', 'CREATE_ROLE', 'DELETE_ROLE', 'REMOVE_PRIVILEGE', 'RENAME_ROLE', 'UNASSIGN_ROLE'],
	'DOCS_SETTINGS' : ['CHANGE_DOCS_SETTING', 'TRANSFER_DOCUMENT_OWNERSHIP'],
	'DOMAIN_SETTINGS' : ['ADD_DOMAIN_ALIAS', 'ADD_SECONDARY_DOMAIN', 'AUTHORIZE_API_CLIENT_ACCESS', 'CHANGE_CONFLICT_ACCOUNT_ACTION', 'CHANGE_ACCOUNT_AUTO_RENEWAL', 'CHANGE_ADVERTISEMENT_OPTION', 'CHANGE_CUSTOM_LOGO', 'CHANGE_DOMAIN_DEFAULT_LOCALE', 'CHANGE_DOMAIN_DEFAULT_TIMEZONE', 'CHANGE_DOMAIN_NAME', 'CHANGE_DOMAIN_SUPPORT_MESSAGE', 'CHANGE_LOGIN_BACKGROUND_COLOR', 'CHANGE_LOGIN_ACTIVITY_TRACE', 'CHANGE_LOGIN_BORDER_COLOR', 'CHANGE_ORGANIZATION_NAME', 'CHANGE_PASSWORD_MAX_LENGTH', 'CHANGE_PASSWORD_MIN_LENGTH', 'CHANGE_RENEW_DOMAIN_REGISTRATION', 'CHANGE_SSO_SETTINGS', 'ENABLE_API_ACCESS', 'ENABLE_FEEDBACK_SOLICITATION', 'ENABLE_SERVICE_OR_FEATURE_NOTIFICATION', 'GENERATE_PIN', 'MX_RECORD_VERIFICATION_CLAIM', 'REGENERATE_OAUTH_CONSUMER_SECRET', 'REMOVE_API_CLIENT_ACCESS', 'REMOVE_DOMAIN_ALIAS', 'REMOVE_SECONDARY_DOMAIN', 'TOGGLE_ALLOW_ADMIN_PASSWORD_RESET', 'TOGGLE_AUTO_ADD_NEW_SERVICE', 'TOGGLE_ENABLE_OAUTH_CONSUMER_KEY', 'TOGGLE_CONTACT_SHARING', 'TOGGLE_ENABLE_PRE_RELEASE_FEATURES', 'TOGGLE_OAUTH_ACCESS_TO_ALL_APIS', 'TOGGLE_OPEN_ID_ENABLED', 'TOGGLE_OUTBOUND_RELAY', 'TOGGLE_SSL', 'TOGGLE_SSO_ENABLED', 'TOGGLE_USE_CUSTOM_LOGO', 'TOGGLE_USE_NEXT_GEN_CONTROL_PANEL', 'UPDATE_DOMAIN_PRIMARY_ADMIN_EMAIL', 'UPDATE_SECONDARY_EMAIL', 'UPLOAD_OAUTH_CERTIFICATE', 'VERIFY_DOMAIN_ALIAS', 'VERIFY_DOMAIN_ALIAS_MX', 'VERIFY_SECONDARY_DOMAIN', 'VERIFY_SECONDARY_DOMAIN_MX'],
	'EMAIL_SETTINGS' : ['CHANGE_EMAIL_SETTINGS'],
	'GROUP_SETTINGS' : ['ADD_GROUP_MEMBER', 'CHANGE_GROUP_DESCRIPTION', 'CHANGE_GROUP_NAME', 'CHANGE_GROUP_SETTING', 'CREATE_GROUP', 'DELETE_GROUP', 'REMOVE_GROUP_MEMBER'],
	'LICENSES_SETTINGS' : ['CHANGE_LICENSE_AUTO_ASSIGN', 'ORG_ALL_USERS_LICENSE_ASSIGNMENT', 'ORG_LICENSE_REVOKE', 'ORG_USERS_LICENSE_ASSIGNMENT', 'USER_LICENSE_ASSIGNMENT', 'USER_LICENSE_REASSIGNMENT', 'USER_LICENSE_REVOKE'],
	'MOBILE_SETTINGS' : ['CHANGE_MOBILE_SETTING', 'MOBILE_DEVICE_APPROVE', 'MOBILE_DEVICE_BLOCK', 'MOBILE_DEVICE_CANCEL_WIPE_THEN_APPROVE', 'MOBILE_DEVICE_CANCEL_WIPE_THEN_BLOCK', 'MOBILE_DEVICE_DELETE', 'MOBILE_DEVICE_WIPE'],
	'ORG_SETTINGS' : ['CREATE_ORG_UNIT', 'EDIT_ORG_UNIT_DESCRIPTION', 'EDIT_ORG_UNIT_NAME', 'MOVE_ORG_UNIT', 'REMOVE_ORG_UNIT', 'TOGGLE_SERVICE_ENABLED'],
	'SECURITY_SETTINGS' : ['ALLOW_ASP_WITHOUT_2SV'],
	'SITES_SETTINGS' : ['CHANGE_SITES_SETTING'],
	'SYSTEM_SETTINGS' : ['CHANGE_SYSTEM_SETTING'],
	'USER_SETTINGS' : ['ADD_NICKNAME', 'BULK_UPLOAD', 'BULK_UPLOAD_NOTIFICATION_SENT', 'CANCEL_USER_INVITE', 'CHANGE_FIRST_NAME', 'CHANGE_LAST_NAME', 'CHANGE_PASSWORD', 'CHANGE_PASSWORD_ON_NEXT_LOGIN', 'CREATE_USER', 'DELETE_USER', 'DOWNLOAD_USERLIST_CSV', 'GMAIL_RESET_USER', 'GRANT_ADMIN_PRIVILEGE', 'GRANT_DELEGATED_ADMIN_PRIVILEGES', 'MAIL_ROUTING_DESTINATION_ADDED', 'MAIL_ROUTING_DESTINATION_REMOVED', 'MOVE_USER_TO_ORG_UNIT', 'REMOVE_NICKNAME', 'RENAME_USER', 'RESEND_USER_INVITE', 'RESET_SIGNIN_COOKIES', 'REVOKE_ADMIN_PRIVILEGE', 'REVOKE_ASP', 'REVOKE_3LO_TOKEN', 'SUSPEND_USER', 'TOGGLE_AUTOMATIC_CONTACT_SHARING', 'UNDELETE_USER', 'UNSUSPEND_USER', 'UPDATE_BIRTHDATE', 'USER_INVITE', 'VIEW_TEMP_PASSWORD']
	};
	//END  - Activity report handling functions
	
	//QUEUE Validation functions.
	function validateMasterQueueConf(){
		var isValidInput = true;
		if($("#dailyApiLimit").val().trim()!=""){
			var  nDailyApiLimit = parseInt($("#dailyApiLimit").val().trim())
			if(nDailyApiLimit<1){
				alert('Please specify valid value for \'Daily API Limit\'.');
				$("#dailyApiLimit").focus();
				isValidInput = false;
			}			
		}else{
			alert('Please specify valid value for \'Daily API Limit\'.');
			isValidInput = false;
		}
		if($("#BatchInterval").val().trim()!=""){
			var  BatchInterval = parseInt($("#BatchInterval").val().trim())
			if(BatchInterval > (24*60) || BatchInterval<1){
				alert('Please specify valid value for \'Schedule Batch Interval\'.\n\n\t[ Valid Range: 1 to '+(24*60)+' ]');
				$("#BatchInterval").focus();
				isValidInput = false;
			}
		}else{
			alert('Please specify valid value for \'Schedule Batch Interval\'.\n\n\t[ Valid Range: 1 to '+(24*60)+' ]');
			isValidInput = false;
		}
		return isValidInput;
	}
	
	function validateAuditReportParam(){
		var stDt = $("#startTimeDt").datepicker( "getDate" );
		var endDt = $("#endTimeDt").datepicker( "getDate" );
		if(stDt!=null && endDt!=null){
			if(stDt>endDt){
				alert('Please select a valid Time range. The \'Start Time\' must be less then \'End Time\'.');
				return false;
			}
		}
		if($("#ActivityReportType").val().trim() != ""){
			if($("#ActivityEventAdmin").val().trim()!= ""){
				if($("#ActivityEventAdminProp").val().trim()== ""){
					alert('Please select a valid \'Filter By Event\' value.');
					return false;
				}
			}
		}	
		return true;
	}

</script>
 <br/>
 
<div class="tabbable">
	<ul class="nav nav-tabs">
	  #{if mainSettings.isSuperAdmin==true || (role.indexOf("Reports")>-1) }
	  <li class="active"><a href="#report_tab" data-toggle="tab">Download Reports</a></li>
	  #{/if}
	  #{if mainSettings.isSuperAdmin==true || (role.indexOf("Tokens")>-1) }
	  	<li>	  	
	  	<a href="#token_tab" data-toggle="tab">Token Management</a></li>
	  	#{/if}
		#{if mainSettings.isSuperAdmin==true || (role.indexOf("MasterQueue")>-1) }
		  <li><a href="#masterQueue_tab" data-toggle="tab">MasterQueue Configuration</a></li>
		#{/if}
		#{if mainSettings.isSuperAdmin==true || (role.indexOf("EmailConf")>-1) }
		  <li><a href="#email_Tab" data-toggle="tab">Email Configuration</a></li>
		#{/if}
		#{if mainSettings.isSuperAdmin==true || (role.indexOf("IPAccess")>-1) }
		  <li><a href="#Whitelisted_IP_Addresses" data-toggle="tab">Security - IP Access</a></li>
		#{/if}
		#{if mainSettings.isSuperAdmin==true || (role.indexOf("UserAccess")>-1) }
		  <li><a href="/userManagement?defaultSelection=AccessRequest" >User Management</a></li>
		#{/if}
	</ul>
	<div class="tab-content">
		<div id="report_tab" class="tab-pane  #{if (mainSettings.isSuperAdmin==true || (role.indexOf("Reports")>-1))}active#{/if}">
	    	<!--  Tab1 Content Start -->
			<div class="row">
				<!-- Start Audit Report -->
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5>1. Retrieve Audit Report</h5>
			        </div>
			        <form action="@{Instructions.RetriveAuditReporting()}" method="POST" enctype="multipart/form-data">
			        	<table>
			        		<tr>
			        			<td>
			        				<div style="margin-bottom:15px;">Report Type:</div>
			        			</td>			        			
			        			<td colspan="4">
									<select id="ActivityReportType" name="ActivityReportType" style="width:200px;" >
										<option default value="admin">Admin Activity Report</option>
										<option value="docs">Docs Activity Report</option>
									</select>
								</td>								
			        		</tr>
			        		<tr>
			        			<td>
			        				<div style="margin-bottom:15px;">Start Time:</div>
			        			</td>
			        			<td>
									<input type="text" id="startTimeDt" name="startTimeDt" style="width:100px;" />
									<div >
										<input type="hidden" id="startTime" name="startTime" style="width:100px;" />
									</div>
			        			</td>
			        			<td style="width:50px;">&nbsp;</td> 
			        			<td>
			        				<div style="margin-bottom:15px;"><nobr>End Time:</nobr></div>
			        			</td>
			        			<td>
				        			<input type="text" id="endTimeDt" name="endTimeDt" style="width:100px;" />
				        			<div >
				        				<input type="hidden" id="endTime" name="endTime" style="width:100px;" />
				        			</div>
			        			</td>
			        		</tr>
			        		<tr>
			        			<td>
			        				<div id="lblEventType" style="margin-bottom:15px;"><nobr>Filter By Activity Type:</nobr></div>
			        			</td>
			        			<td>
			        				<div id="divActivityEventAdmin">
			        				<!--
			        				Admin Activity Report Event Names
			        				https://developers.google.com/admin-sdk/reports/v1/reference/activity-ref-appendix-a/admin-event-names  
			        				-->
										<select id="ActivityEventAdmin" name="ActivityEventAdmin" style="width:200px;" >
											<option default value="">-- All --</option>																						
											<option default value="APPLICATION_SETTINGS">APPLICATION_SETTINGS</option>
											<option default value="CALENDAR_SETTINGS">CALENDAR_SETTINGS</option>											    
											<option default value="CHAT_SETTINGS">CHAT_SETTINGS</option>
											<option default value="CHROME OS_SETTINGS">CHROME OS_SETTINGS</option>
											<option default value="CONTACTS_SETTINGS">CONTACTS_SETTINGS</option>
											<option default value="DELEGATED_ADMIN">DELEGATED_ADMIN</option>
											<option default value="DOCS_SETTINGS">DOCS_SETTINGS</option>
											<option default value="DOMAIN_SETTINGS">DOMAIN_SETTINGS</option>
											<option default value="EMAIL_SETTINGS">EMAIL_SETTINGS</option>
											<option default value="GROUP_SETTINGS">GROUP_SETTINGS</option>
											<option default value="LICENSES_SETTINGS">LICENSES_SETTINGS</option>
											<option default value="MOBILE_SETTINGS">MOBILE_SETTINGS</option>
											<option default value="ORG_SETTINGS">ORG_SETTINGS</option>
											<option default value="SECURITY_SETTINGS">SECURITY_SETTINGS</option>
											<option default value="SITES_SETTINGS">SITES_SETTINGS</option>
											<option default value="SYSTEM_SETTINGS">SYSTEM_SETTINGS</option>
											<option default value="USER_SETTINGS">USER_SETTINGS</option>
										</select>
									</div>
			        				<div id="divActivityEventDoc" name="divActivityEventDoc" style="display:none;">
										<select id="ActivityEventDoc" style="width:200px;" >
											<option default value="">-- All --</option>
											<option value="view">View</option>
											<option value="edit">Edit</option>											
										</select>
									</div>
			        			</td>
			        			<td style="width:50px;">&nbsp;</td> 
			        			<td>
			        				<div style="margin-bottom:15px;"><nobr>Filter By User:</nobr></div>
			        			</td>
			        			<td>
									<input type="text" id="userEmail" name="userEmail" style="width:100px;" />
			        			</td>
			        		</tr>
			        		<tr id="trActivityEventAdminProp">
			        			<td>
			        				<div style="margin-bottom:15px;"><nobr>Filter By Event:</nobr></div>
			        			</td>
			        			<td colspan="4">
			        				<div id="divActivityEventAdminName">
										<select id="ActivityEventAdminProp" name="ActivityEventAdminProp" style="width:200px;" >
											<option default value="">-- None --</option>																						
										</select>
									</div>
								</td>
			        		</tr>
			        		<tr >
			        			<td>			        			
			        			</td>
			        			<td colspan="4">
			        				<table>
			        					<tr><td>
				        					<input style="margin-bottom:8px;margin-left:0px;height:30px;" type="submit" value="Get Report" onclick="return validateAuditReportParam()"/>
				        				</td>
				        				<td style="width:5px;"><div>&nbsp;</div></td>
				        				<td style="width:100%;">
					        				<div style="float:right;margin-top:-3px;">
						        				<nobr>
									        		Help : <a href="https://developers.google.com/admin-sdk/reports/v1/guides/manage-audit-admin.html" target="_blank">Admin audit reports</a>
									        		&nbsp;/&nbsp;
									        		<a href="https://developers.google.com/admin-sdk/reports/v1/guides/manage-audit-docs.html" target="_blank">Google Docs audit reports</a>
									        	</nobr>
								        	</div>
				        				</td></tr>
						        	</table>					
								</td>
			        		</tr>
			        	</table>					    
					</form>
			    </div>
				<!-- Start Report Activity Section -->
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5>2. Retrieve Activity Report</h5>
			        </div>
			        <form action="@{Instructions.RetriveActivityReporting()}" method="POST" enctype="multipart/form-data">
			        	<table>
				        	<tr>
					        	<td>
						        	<select id="month" name="month" style="width:130px;">
						        		<option value="" selected="selected" >Max retention of 2 calendar months</option>
						        		<option value="this" >This Month</option>
						        		<option value="last">Last Month</option>
						        	</select>
					        	</td>
					        	<td>
					        		<div style="margin-left:50px;">&nbsp;</div>
					        	</td>
					        	<td>
					        	   	<input style="margin-bottom:8px;margin-left:13px;height:30px;" type="submit" value="Get Report" />
					        	</td>
					        	<td style="width:100%;">&nbsp;</td>
					        	
				        	</tr>
				        	<tr>
					        	<td colspan="3">
						        	<span>
						        		Help : <a href="https://developers.google.com/google-apps/reporting/#activity_report" target="_blank">Field Definitions for the Activity Report</a>
						        	</span>
						    	</td>
						    </tr>
					    </table>
					</form>
			    </div>
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5>3. Retrieve Email Client Report</h5>
			        </div>
			        <form action="@{Instructions.RetriveEmailClientReporting()}" method="POST" enctype="multipart/form-data">
			        	<table>
				        	<tr>
					        	<td>
						        	<select id="month" name="month" style="width:130px;">
						        		<option value="" selected="selected" >Max retention of 2 calendar months</option>
						        		<option value="this" >This Month</option>
						        		<option value="last">Last Month</option>
						        	</select>
					        	</td>
					        	<td>
					        		<div style="margin-left:50px;">&nbsp;</div>
					        	</td>
					        	<td>
					        	   	<input style="margin-bottom:8px;margin-left:13px;height:30px;" type="submit" value="Get Report" />
					        	</td>
					        	<td style="width:100%;">&nbsp;</td>
				        	</tr>
				        	<tr>
					        	<td colspan="4">
						        	<span>
						        		Help : <a href="https://developers.google.com/google-apps/reporting/#email_clients_report" target="_blank">Field Definitions for the Email Clients Report</a>
						        	</span>
						    	</td>
						    </tr>
					    </table>
					    
					</form>
			    </div>
				<!-- END Report Activity Section -->
			</div>
			<!-- END Audit Report -->			
		</div>
		<!-- Start Token Report -->
		<div id="token_tab" class="tab-pane #{if (mainSettings.isSuperAdmin==true || (role.indexOf("Tokens")>-1))}active#{/if}">
	    	<!--  Tab2 Content Start -->
			<div class="row">
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5>1. Retrieve All User Token Credentials</h5>
			        </div>
			        <form action="@{Instructions.Upload_getAllUserCrd()}" method="POST" enctype="multipart/form-data">
			        	<table>
				        	<tr>
					        	<td>
								    <input type="File" name="requestAllUserCrd" id="requestAllUserCrd"/>
							    </td>
							    <td>
							    	<div style="margin-left:20px;">								    	
								    	<input style="margin-bottom:8px;margin-top:6px;height:30px;" type="submit" value="Upload CSV"/>
								    </div>
							    </td>
							    <td>
							    	<div style="margin-left:60px;margin-top:-8px;">
							    		<input type="checkbox" name="requestAllUserCrdCHK" id="requestAllUserCrdCHK"/>
								    </div>
							    </td>
							    <td >
							    	<div style="width:130px;margin-left:10px;">Queue for email ?</div>							    	
							    </td>
						    </tr>
					    </table>
					</form>
			    </div>
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5>2. Retrieve All User Token Credentials By Client-Id</h5>
			        </div>
			        <form action="@{Instructions.Upload_getAllUserCrdForClient()}" method="POST" enctype="multipart/form-data">
			        	<table>
				        	<tr>
					        	<td>
								    <input type="File" name="requestAllUserForClientCrd" id="requestAllUserForClientCrd"/>
							    </td>
							    <td>
							    	<div style="margin-left:20px;">
								    	<input style="margin-bottom:8px;margin-top:6px;height:30px;" type="submit" value="Upload CSV"/>
								    </div>
							    </td>
							    <td>
							    	<div style="margin-left:60px;margin-top:-8px;">
							    		<input type="checkbox" name="requestAllUserForClientCrdCHK" id="requestAllUserForClientCrdCHK"/>
								    </div>
							    </td>
							    <td >
							    	<div style="width:130px;margin-left:10px;">Queue for email ?</div>							    	
							    </td>
						    </tr>
					    </table>
					</form>
			    </div>
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5>3. Revoke Assigned Token Credentials</h5>
			        </div>	
			        <form action="@{Instructions.Upload_revokeUserCrd()}" method="POST" enctype="multipart/form-data">
			        	<table>
				        	<tr>
					        	<td>
								    <input type="File" name="revokeUserCrd" id="revokeUserCrd"/>
							    </td>
							    <td>
							    	<div style="margin-left:20px;">
								    	<input style="margin-bottom:8px;margin-top:6px;height:30px;" type="submit" value="Upload CSV"/>
								    </div>
							    </td>
							    <td>
							    	<div style="margin-left:60px;margin-top:-8px;">
							    		<input type="checkbox" name="revokeUserCrdCHK" id="revokeUserCrdCHK"/>
								    </div>
							    </td>
							    <td >
							    	<div style="width:130px;margin-left:10px;">Queue for email ?</div>							    	
							    </td>
						    </tr>
					    </table>			        
					</form>
			    </div>					
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5>4. Process On MasterQueue For Emails</h5>
			        </div>	
			        <form action="@{Instructions.Upload_masterQueue()}" method="POST" enctype="multipart/form-data">
			        	<table>
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;">
				        				<span>Upload file</span>
				        			</div>
				        		</td>
				        		<td style="width:400px;">			
				        				        		
				        			<div style="margin-bottom:10px;">
				        				<input type="file" name="masterQueueUpload" id="masterQueueUpload"/>
				        			</div>
				        		</td>				        	
							</tr>
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;">
				        				<span>Position</span>
				        			</div>
				        		</td>
				        		<td style="width:400px;">
				        			<div style="margin-bottom:10px;">
									     <select name="position" > 
									    	<option default value="end">End</option>
									    	<option value="next">Next</option>
									    </select>
								    </div>
				        		</td>				        	
							</tr>
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;">				        				
				        			</div>
				        		</td>
				        		<td style="width:400px;">			
								    	<input style="margin-bottom:8px;margin-top:6px;height:30px;" type="submit" value="Upload CSV"/>
				        		</td>
							</tr>						
						</table>
						<br/>
						<br/>
					</form>
			    </div>
			    <!--  Blank Header -->			    
			</div>
	    </div>
	    <!-- END Token Report -->
    	<!--  Tab1 Content Start -->
		<!-- Start Master Queue -->
		<div id="masterQueue_tab" class="tab-pane  #{if (mainSettings.isSuperAdmin==true || (role.indexOf("MasterQueue")>-1))}active#{/if}">
	    	<!--  Tab2 Content Start -->
			<div class="row">
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5><a id="bar" href="javascript:void(0)" data-geo="data-geo"> 1. Master Queue Configuration (Click/hover for detail)</a></h5>
			        </div>
			        <form action="@{Instructions.UpdateMasterQueueConf()}" method="POST" enctype="multipart/form-data">
			        	<table >
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;" data-geo="data-geo">
				        				<span>Daily API Limit </span>
				        			</div>
				        		</td>
				        		<td style="width:400px;">
				        			<div><input type="text" name="dailyApiLimit" id="dailyApiLimit" value="${mainSettings.defaultSetting.getProperty("dailyApiLimit")}" /></div>
				        			<div style="margin-top:-8px;margin-bottom:15px;">(eg. 1990)</div>
				        			
				        		</td>
							</tr>
			        		<tr>
			        			<td  valign="top">
			        				<div style="margin-top:10px;" data-geo="data-geo">
				        				<span><nobr>Schedule Batch Interval</nobr></span>
				        			</div>
				        		</td>
				        		<td>
				        			<div><input type="text" name="BatchInterval" id="BatchInterval" value="${mainSettings.defaultSetting.getProperty("BatchInterval")}" /></div>
				        			<div style="margin-top:-8px;margin-bottom:15px;"><span>(eg. 10 => 1 batch will run every 10min in this example)</div>
				        		</td>				        	
							</tr>
			        		<tr>
			        			<td>				        			
				        		</td>
				        		<td >
				        			<div style="margin-top:10px;">
				        				<input style="height:30px;" type="submit" value="Update" onclick="return validateMasterQueueConf()"/>
			        				</div>
				        		</td>				        	
							</tr>						    
					    </table>
					    <script>
						    				    
					    	function getQueueHelp(){
					    		var objDailyApiLimit = document.getElementById("dailyApiLimit");
					    		var objBatchInterval = document.getElementById("BatchInterval");					    		
					    		if(objBatchInterval!=null && objDailyApiLimit!=null){
					    			var ndailyApiLimit = 0;
					    			var nBatchInterval = 0;
					    			var nTotalUserPerbatch = 0;
					    			var nTotalBatchPerDay = 0;
					    			var nActualApiLimit = 0;
					    			try{
					    				ndailyApiLimit = parseInt(objDailyApiLimit.value);
					    				nBatchInterval = parseInt(objBatchInterval.value);
					    				nTotalBatchPerDay = Math.floor((24*60)/nBatchInterval);
					    				nTotalUserPerbatch = Math.floor(ndailyApiLimit/nTotalBatchPerDay);
					    				nActualApiLimit = nTotalBatchPerDay * nTotalUserPerbatch;
					    			}catch(e){
					    				
					    			}
					    			var helpText = "<div class='ui-widget'><div class='ui-widget-header ui-corner-all'>";
					    			helpText += "<table class='map' style='border-collapse:collapse;border: 1px solid #DDDDDD;width:100%'><tr><td><table style='margin-left:5px;margin-right:2px;'>";
					    			helpText += "<tr><td colspan='2'><b>This Setting will set MasterQueue for :</b></td></tr>";
					    			helpText += "<tr><td colspan='2' style='border-bottom: 1px solid #DDDDDD'>&nbsp;</td></tr>";
					    			helpText += "<tr><td>Total calls would be made per day : </td><td>"+nActualApiLimit+"</td>";
					    			helpText += "<tr><td>Total users would be processed in the day: </td><td>"+nActualApiLimit+"</td>";
					    			helpText += "<tr><td>Total users would be processed in the batch: </td><td>"+nTotalUserPerbatch+"</td>";					    			
					    			helpText += "<tr><td>Total batch would be processed in the day: </td><td>"+nTotalBatchPerDay+"</td>";
					    			helpText += "<tr><td>Interval time for each Batch: </td><td>"+nBatchInterval+" minutes</td>";					    			
					    			helpText += "<tr><td colspan='2'>&nbsp;</td></tr>";
					    			helpText += "<tr><td colspan='2'><b>Note :</b><br/> If actual processing time for a batch is exceeded the specified Batch-Interval, than lesser number of users will be processed per day.</td></tr>";
					    			helpText += "</table></td></tr></table></div></div>"
					    			return helpText;					    			
					    		}
					    	}
					    </script>
					</form>
			    </div>			    
			</div>
			<!--  -->
			<!--  -->
			<div class="row">
			    <div class="span8 offset2" >
			        <div class="page-header">
			            <h5>2. Master Queue Status</h5>
			        </div>
		        	<table>
		        		<tr >
							<td style="width:250px"><div style="width:280px;"> 1. Queue Status</div></td>
							<td><div style="width:10px;">&nbsp;</div></td>
							<td style="width:100%;"><div style="overflow-x: scroll;">
									<img src="/public/images/${mainSettings.currentQueueStatusIcon}">
									<div style="width:10px;">&nbsp;</div>
									${mainSettings.currentQueueStatus}
								</div>
							</td>
						</tr>
						<tr><td colspan="5"><div class="borderTr">&nbsp;</div></td></tr>
		        		<tr >
							<td >2. Current Item in progress</td>														
							<td ><div style="width:10px;">&nbsp;</div></td>
							<td><div style="overflow-x: scroll;">${mainSettings.currentQueueItemTime}<br/>${mainSettings.currentQueueItemDetail}
								</div>
							</td>
						</tr>
						<tr><td colspan="5"><div class="borderTr">&nbsp;</div></td></tr>
		        		<tr >
							<td >3. Last Batch Processed at :</td>
							<td ><div style="width:10px;">&nbsp;</div></td>
							<td >${mainSettings.LastQueueProcessedTime}</td>
						</tr>
						<tr><td colspan="5"><div class="borderTr">&nbsp;</div></td></tr>
		        		<tr >
							<td >4. Next Batch Scheduled at :</td>
							<td ><div style="width:10px;">&nbsp;</div></td>
							<td 	>${mainSettings.NextScheduledBathTime}</td>
						</tr>
						<tr><td colspan="5"><div class="borderTr">&nbsp;</div></td></tr>
		        		<tr >
							<td >5. Pending Items In Current Batch</td>
							<td ><div style="width:10px;">&nbsp;</div></td>
							<td >${mainSettings.itemsPendingInCurrentBatch}</td>
						</tr>
						<tr><td colspan="5"><div class="borderTr">&nbsp;</div></td></tr>
		        		<tr >
							<td >6. Total Batch Pending in Master Queue</td>
							<td ><div style="width:10px;">&nbsp;</div></td>
							<td >${mainSettings.totalBatchPendingInMasterQueue}</td>
						</tr>
		        		<tr>
		        			<td colspan="2"></td>
		        			<td >
								<form action="@{Instructions.Index()}" method="GET" >								
				        			<div style="margin-top:10px;">
										<input style="height:30px;" type="submit" value="Refresh" />				        				
				        			</div>
								</form>
			        		</td>
			        		<td><div style="width:60px;">&nbsp;</div></td>
						</tr>
					</table>				
				</div>
			</div>
			<div class="row">
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5>3. Master Queue Scheduler</h5>
			        </div>
		        	<table>
		        		<tr>
		        			<td >
								<form action="@{Instructions.startMasterQueue()}" method="POST" >
				        			<div style="margin-top:10px;"><input style="height:30px;" type="submit" value="Start MasterQueue" /></div>
								</form>
			        		</td>
			        		<td><div style="width:60px;">&nbsp;</div></td>
			        		<td style="width:400px;">
								<form action="@{Instructions.stopMasterQueue()}" method="POST" >
				        			<div style="margin-top:10px;"><input type="submit" style="height:30px;" value="Stop MasterQueue" /></div>
								</form>
			        		</td>
			        	</tr>
			        	<tr>
			        		<td style="width:400px;">
								<form action="@{Instructions.downloadMasterQueue()}" method="POST" >
				        			<div style="margin-top:10px;"><input type="submit" style="height:30px;" value="Download MasterQueue" /></div>
								</form>
			        		</td>
			        		<td><div style="width:60px;">&nbsp;</div></td>
			        		<td style="width:400px;">
								<form action="@{Instructions.resetMasterQueue()}" method="POST" >
				        			<div style="margin-top:10px;"><input type="submit" style="height:30px;" value="Reset MasterQueue" /></div>
								</form>
			        		</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
		<!-- END Master Queue -->		
		<div id="Whitelisted_IP_Addresses" class="tab-pane  #{if (mainSettings.isSuperAdmin==true || (role.indexOf("IPAccess")>-1))}active#{/if}">
	    	<!--  Tab2 Content Start -->
			<div class="row">
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5>Whitelisted Access</h5>
			        </div>
			        <form action="@{Instructions.UpdateWhitelistedIP()}" method="POST" enctype="multipart/form-data">
			        	<table>
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;">
				        				<span>1. Whitelisted IPs</span>
				        			</div>
				        		</td>
				        		<td style="width:400px;">
				        			<div>
				        				<textarea type="text" name="WhitelistedIPs" id="WhitelistedIPs" >${mainSettings.defaultSetting.getProperty("WhitelistedIPs")}</textarea>
				        				<div style="margin-top:-8px;margin-bottom:15px;"><span>(Comma separated IP-addresses - 127.0.0.1,198.2.1.98)</div>				        				
				        			</div>				        			
				        		</td>
				        	</tr>
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;">
				        				<span>2. Whitelisted Domains</span>
				        			</div>
				        		</td>
				        		<td style="width:400px;">
				        			<div>
				        				<textarea type="text" name="WhitelistedDomains" id="WhitelistedDomains" >${mainSettings.defaultSetting.getProperty("WhitelistedDomains")}</textarea>
				        				<div style="margin-top:-8px;margin-bottom:15px;"><span>(Comma separated Domains - salesforce.com,google.com)</div>				        				
				        			</div>				        			
				        		</td>
				        	</tr>				        	
							<tr>
			        			<td style="width:200px;" valign="top">
				        		</td>
				        		<td style="width:400px;">
				        			<div>
				        				<div style="margin-top:10px;"><input style="height:30px;" type="submit" value="Update" /></div>
				        			</div>
				        		</td>
							</tr>				

							</tr>
						</table>
					</form>
				</div>
			</div>
		</div>
		<!--  Start Email Configuration-->
		<div id="email_Tab" class="tab-pane  #{if (mainSettings.isSuperAdmin==true || (role.indexOf("EmailConf")>-1))}active#{/if}">
	    	<!--  Tab2 Content Start -->
			<div class="row">
			    <div class="span8 offset2">
			        <div class="page-header">
			            <h5>1. Email Configuration</h5>
			        </div>
			        <form action="@{Instructions.UpdateConfForEmail()}" method="POST" enctype="multipart/form-data">
			        	<table>
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;">
				        				<span>To Address (Admin)</span>
				        			</div>
				        		</td>
				        		<td style="width:400px;">
				        			<div>
				        				<input type="text" name="ToAddress" id="ToAddress" value="${mainSettings.defaultSetting.getProperty("ToAddress")}"/>
				        				<div style="margin-top:-8px;margin-bottom:15px;"><span>(Comma separated  email addresses)</div>				        				
				        			</div>				        			
				        		</td>				        	
							</tr>
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;">
				        				<span>From Address</span>
				        			</div>
				        		</td>
				        		<td style="width:400px;">
				        			<div>
				        				<input type="text" name="FromAddress" id="FromAddress" value="${mainSettings.defaultSetting.getProperty("FromAddress")}"/>
				        			</div>				        			
				        		</td>
							</tr>
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;">
				        				<span>Reply To Address</span>
				        			</div>
				        		</td>
				        		<td style="width:400px;">
				        			<div>
				        				<input type="text" name="ReplyToAddress" id="ReplyToAddress" value="${mainSettings.defaultSetting.getProperty("ReplyToAddress")}"/>
				        			</div>				        			
				        		</td>
							</tr>
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;">
				        				<span>Email Subject</span>
				        			</div>
				        		</td>
				        		<td style="width:400px;">
				        			<div>
				        				<input type="text" name="EmailSubject" id="EmailSubject" value="${mainSettings.defaultSetting.getProperty("EmailSubject")}"/>
				        			</div>				        			
				        		</td>
							</tr>
			        		<tr>
			        			<td style="width:200px;" valign="top">
			        				<div style="margin-top:10px;">
				        				<span>Email Body</span>
				        			</div>
				        		</td>
				        		<td style="width:400px;">
				        			<div>
				        				<textarea style="width:500px;"  name="EmailBody" id="EmailBody" >${mainSettings.defaultSetting.getProperty("EmailBody")}</textarea>
				        			</div>				        			
				        		</td>
							</tr>
							<tr>
			        			<td style="width:200px;" valign="top">
				        		</td>
				        		<td style="width:400px;">
				        			<div>
				        				<div style="margin-top:10px;"><input type="submit" style="height:30px;" value="Update" /></div>
				        			</div>
				        		</td>
							</tr>
						</table>
						<br/>
						<br/>
					</form>
				</div>
			</div>
		</div>
		<!--  END Email Configuration-->
	</div>	
</div>
